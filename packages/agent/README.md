# @agentxjs/agent

**AgentX Agent** - Agent Runtime for AI Agents.

## Overview

AgentX Agent provides the **stateful layer** on top of the stateless Engine. It manages Agent instances (like Spring's ApplicationContext manages Beans).

**Key Design** ("Define Once, Run Anywhere"):

- `AgentDefinition` - Business-level config (name, description, systemPrompt)
- `AgentContext` - Runtime context (agentId, createdAt)
- `AgentDriver` - Created by Runtime (not defined in AgentDefinition)
- `Sandbox` - Resource isolation (OS + LLM), provided by Runtime
- `Agent` - Runtime instance
- `AgentContainer` - Instance lifecycle manager

## Features

- **Runtime-injected Driver** - Driver created by Runtime, not defined in AgentDefinition
- **Sandbox Isolation** - Each Agent has isolated OS + LLM resources
- **Agent Lifecycle** - `running` / `destroyed` state management
- **Type-safe Events** - Subscribe to agent events with type safety
- **Event-driven Architecture** - All communication via EventBus

## Installation

```bash
pnpm add @agentxjs/agent
```

## Quick Start

> **Note**: You typically use `agentx` package (which wraps this), not this package directly.

### Using via agentx (Recommended)

```typescript
import { createAgentX, defineAgent } from "agentxjs";
import { runtime } from "@agentxjs/node-runtime";

// 1. Define agent (business config only)
const MyAgent = defineAgent({
  name: "Assistant",
  systemPrompt: "You are a helpful assistant",
});

// 2. Create platform with runtime
const agentx = createAgentX(runtime);

// 3. Create agent instance (Runtime provides Driver + Sandbox)
const agent = agentx.agents.create(MyAgent);

// 4. Subscribe to events
agent.on("text_delta", (event) => {
  process.stdout.write(event.data.text);
});

// 5. Send message
await agent.receive("Hello!");

// 6. Clean up
await agent.destroy();
```

## Core Interfaces

### AgentContext

Runtime context for agent identity:

```typescript
interface AgentContext {
  readonly agentId: string; // Generated by Runtime
  readonly createdAt: number; // Creation timestamp
}
```

### AgentDefinition

Business-level agent template (no infrastructure details):

```typescript
interface AgentDefinition {
  name: string; // Agent name (required)
  description?: string; // Agent description (optional)
  systemPrompt?: string; // System prompt (optional)
}
```

### AgentDriver

Stateful driver interface (created by Runtime):

```typescript
interface AgentDriver {
  readonly name: string;
  readonly description?: string;
  receive(message: UserMessage): AsyncIterable<StreamEventType>;
  interrupt(): void;
  destroy(): Promise<void>;
}
```

### Sandbox

Resource isolation (OS + LLM):

```typescript
interface Sandbox {
  readonly name: string;
  readonly os: OS; // FileSystem, Process, Env, Disk
  readonly llm: LLMProvider; // apiKey, baseUrl
}
```

## Type-Based Event Subscription

Agent supports type-based event subscription for better performance:

```typescript
// Subscribe to specific event type
agent.on("text_delta", (event) => {
  process.stdout.write(event.data.text);
});

// Subscribe to multiple types
agent.on(["message_start", "message_stop"], (event) => {
  console.log(event.type);
});

// Subscribe to all events
agent.on((event) => {
  console.log(event.type);
});

// Unsubscribe
const unsubscribe = agent.on("text_delta", handler);
unsubscribe();
```

## Agent Lifecycle

```
createAgent()
     │
     ▼
┌─────────────────────────────────────────────────────────────┐
│                      RUNNING                                 │
│                                                              │
│  States:                                                     │
│  ┌─────────┐  receive()  ┌────────────┐  tool_call  ┌─────┐ │
│  │  idle   │ ─────────→  │ responding │ ─────────→  │await│ │
│  └─────────┘  ←─────────  └────────────┘  ←─────────  │tool│ │
│       ▲       message_stop       ▲       tool_result └─────┘ │
│       │                          │                           │
│       └──────────────────────────┘                           │
│              abort() / interrupt()                           │
└─────────────────────────────────────────────────────────────┘
     │
     │ destroy()
     ▼
┌─────────────────────────────────────────────────────────────┐
│                     DESTROYED                                │
└─────────────────────────────────────────────────────────────┘
```

## Related Packages

- **[agentxjs](../agentx)** - Platform API (defineAgent, createAgentX)
- **[@agentxjs/node-runtime](../agentx-runtime)** - Node.js Runtime (NodeRuntime, ClaudeDriver)
- **[@agentxjs/engine](../agentx-engine)** - Stateless event processing engine
- **[@agentxjs/types](../agentx-types)** - Type definitions

## License

MIT
